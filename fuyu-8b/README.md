# Fuyu 8B Truss

This repository packages [Fuyu 8B](https://www.adept.ai/blog/fuyu-8b) as a [Truss](https://truss.baseten.co/).

Fuyu 8B is a multimodal model that accepts images of any size and a prompt. It can then answer you question(prompt) by extracting information from the image. This model can be used for answering questions about graphs and diagrams, answer UI-based questions, etc.

## Deploying Fuyu 8B

First, clone this repository:

```sh
git clone https://github.com/basetenlabs/truss-examples/
cd fuyu-8b
```

Before deployment:

1. Make sure you have a [Baseten account](https://app.baseten.co/signup) and [API key](https://app.baseten.co/settings/account/api_keys).
2. Install the latest version of Truss: `pip install --upgrade truss`

With `fuyu-8b` as your working directory, you can deploy the model with:

```sh
truss push
```

Paste your Baseten API key if prompted.

For more information, see [Truss documentation](https://truss.baseten.co).

## Hardware Requirements
Although this model is 8 billion parameters, it requires a significant amount of of GPU compute. An A100 is required to run this model.

## Invoking the model

Here are the following inputs for the model:
1. `image`: The input image you want to ask questions about as a base64 string.
2. `prompt`: The question/statement you'd like to ask about the image.
3. `max_new_tokens`: The maximum number of tokens generated by the model.

Here is an example of how to invoke this model:

```python
def pil_to_b64(pil_img):
    buffered = BytesIO()
    pil_img.save(buffered, format="PNG")
    img_str = base64.b64encode(buffered.getvalue()).decode("utf-8")
    return img_str

img = Image.open("/path/to/image/sample_graph.jpeg")
data = {"prompt": "What is the highest marketing expenditure?", "image": pil_to_b64(img), "max_new_tokens": 50}
headers = {"Authorization": f"Api-Key <BASETEN-API-KEY>"}
res = requests.post("https://model-<model-id>.api.baseten.co/development/predict", headers=headers, json=data)
res = res.json()
print(res)
```

Here is the example input image used:
![sample_graph](https://github.com/htrivedi99/truss-examples/assets/15642666/9e475fdb-da45-474b-8b93-9b272784d42b)

Here is the output:
```txt
"Conventions" is the leading category of marketing expenditures.
```
